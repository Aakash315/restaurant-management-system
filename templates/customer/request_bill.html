{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
<a href="{% url 'menu_view' %}" class="btn btn-success">
  ‚Üê Back to Menu
</a>
<h3 class="mt-3 text-center" style="color: brown;">üßæ Your Bill</h3>
<table class="request-table">
  <thead>
    <tr>
      <th>Sr. No.</th>
      <th>Item</th>
      <th>Qty</th>
      <th>Price</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    {% for item in order.items.all %}
    <tr>
      <td><strong>{{ forloop.counter }}</strong></td>
      <td><strong>{{ item.item.name|title }}</strong></td>
      <td class="text-center"><strong>{{ item.quantity }}</strong></td>
      <td class="text-center"><strong>{{ item.item.price }} /-</strong></td>
      <td class="text-center"><strong>{{ item.total_price|floatformat:2 }} /-</strong></td>
    </tr>
    {% endfor %}
    <tr>
      <td colspan="4" class="text-end"><strong>Subtotal</strong></td>
      <td class="text-center"><strong>{{ bill.total }} /-</strong></td>
    </tr>
    <tr>
      <td colspan="4" class="text-end"><strong>CGST ({{ bill.get_tax_settings.cgst }}%)</strong></td>
      <td class="text-center"><strong>{{ bill.cgst_amount|floatformat:2 }} /-</strong></td>
    </tr>
    <tr>
      <td colspan="4" class="text-end"><strong>SGST ({{ bill.get_tax_settings.sgst }}%)</strong></td>
      <td class="text-center"><strong>{{ bill.sgst_amount|floatformat:2 }} /-</strong></td>
    </tr>
    <tr>
      <td colspan="4" class="text-end"><strong>Tip</strong></td>
      <td class="text-center"><strong>{{ bill.tip }} /-</strong></td>
    </tr>
    <tr style="background-color: rgb(11, 154, 11);">
      <td colspan="4" class="text-end"><strong>Grand Total</strong></td>
      <td class="text-center"><strong>{{ bill.grand_total_with_tax|floatformat:2 }} /-</strong></td>
    </tr>
  </tbody>
</table>

<!-- Tip form -->
<form method="post" action="{% url 'submit_tip' %}">
  {% csrf_token %}
  <div class="mb-3 mt-3">
    <label class="form-label">Add Tip (Optional)</label>
    <input type="number" name="tip" step="0.5" class="form-control" placeholder="Enter tip amount"
      value="{{ bill.tip }}">
  </div>
  <button class="btn btn-success"><i class="bi bi-cash-coin"></i> Submit Tip</button>
</form>


{% if bill.is_paid %}
<a href="{% url 'leave_feedback' %}" class="btn btn-outline-primary mt-3">
  <i class="bi bi-chat-dots"></i> Leave Feedback
</a>
{% endif %}
</div>  
{% endblock %}